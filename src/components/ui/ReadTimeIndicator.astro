---
import { calcReadTime } from "@/scripts/utilities";
import type { CollectionEntry } from "astro:content";
import { setStyles, Color, Pattern } from "@/scripts/interface";

interface Props {
	content: CollectionEntry<"posts"> | CollectionEntry<"tools">;
}

const { content } = Astro.props;
---

<div class="flex flex-col gap-2">
	<span class="heading-xs">{calcReadTime(content.body)} min read</span>
	<span
		class="flex justify-start items-center w-full h-4 px-1 bg-black rounded-[var(--radius-sm)]"
		style={setStyles("indicator", Color.lime, Pattern["2"]) + "--prog-w: 40px"}
	>
		<span
			data-article-progress
			class="bg-[var(--indicator-color)] rounded-[1px] min-w-2 max-w-full h-2"
			onscroll="showScrollProgress()"></span>
	</span>
</div>

<style>
	[data-article-progress] {
		position: relative;

		&::before {
			position: absolute;
			width: 100%;
			height: 100%;
			background-image: var(--indicator-pattern);
			opacity: 0.2;
			content: "";

			animation: marquee 5s linear infinite;
		}
	}

	@media (prefers-reduced-motion: reduce) {
		[data-article-progress]::before {
			animation: none;
		}
	}
</style>

<script is:inline>
	const progressIndicator = document.querySelector("[data-article-progress]");

	window.onscroll = function () {
		const windowScroll = document.body.scrollTop || document.documentElement.scrollTop;
		const height =
			document.documentElement.scrollHeight - document.documentElement.clientHeight;
		const scrolled = (windowScroll / height) * 110;

		progressIndicator.style.width = scrolled + "%";
	};
</script>
