---
import TagList from "@/components/TagList.astro";
import type { CollectionEntry } from "astro:content";
import { Image } from "astro:assets";
import Icon from "@/ui/Icon.astro";

interface Props {
	model: CollectionEntry<"models">;
}

const { model } = Astro.props;
const { title, subTitle, tags } = model.data;

function generateRotation(): string {
	const min = -6;
	const max = 6;
	const randomInt = Math.floor(Math.random() * (max - min + 1)) + min;

	return randomInt + "deg";
}
---

<div data-model-card class="relative">
	<strong
		class:list={[
			"absolute -inset-3 flex flex-col gap-2 border-sm shadow-lg bg-white w-fit h-fit py-2 px-4 z-1",
			"max-sm:-inset-x-2",
		]}
	>
		{title}
	</strong>
	<a
		href={`/models/${model.slug}`}
		class="flex flex-col justify-start overflow-clip border-lg shadow-lg bg-white"
	>
		<div class:list={["flex justify-center items-center p-2", "max-sm:p-0"]}>
			<Image
				src={`/images/models/${model.slug}/header.png`}
				alt={`${title}-${subTitle}`}
				class="rounded-[var(--radius-sm)] w-full aspect-video"
				width="1920"
				height="1080"
				format="webp"
			/>
		</div>
	</a>
	<div
		data-hover-text
		class:list={[
			"absolute invisible flex inset-3 justify-center items-center pointer-events-none",
			"max-sm:visible",
		]}
	>
		<strong
			style={{ "--text-rotation": generateRotation() }}
			class="flex gap-2 items-center p-3 border-2 bg-neutral rounded-sm rotate-(--text-rotation) shadow-lg"
		>
			View details <Icon name="arrow-right" />
		</strong>
	</div>
	<TagList class="absolute -bottom-2 left-6" {tags} />
</div>

<style>
	[data-model-card] > a {
		position: relative;
		overflow: hidden;

		&:hover::before {
			position: absolute;
			inset: calc(var(--spacing) * 2);
			content: "";

			background-color: var(--color-white);
			border-radius: var(--radius-sm);

			opacity: 0.2;
		}
	}

	[data-model-card]:hover [data-hover-text] {
		visibility: visible;
		overflow: hidden;

		border-radius: var(--radius-sm);

		&::before {
			position: absolute;
			inset: 0;
			content: "";

			background-image: var(--bg-6);
			border-radius: var(--radius-sm);

			transform: scale(2);
			animation: button-marquee 5s linear infinite;
			opacity: 0.05;
		}
	}
</style>
