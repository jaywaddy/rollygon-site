---
import Icon, { matchIconNameType } from "@/ui/Icon.astro";
import Button from "@/ui/Button.astro";
import Badge from "./ui/Badge.astro";
import { calcReadTime, formatDate } from "@/scripts/utilities";
import TagList from "./TagList.astro";
import { ALL_TOOLS, type Collection } from "@/content/config";
import ImageWrapper from "./ui/ImageWrapper.astro";

interface Props {
	content: Collection;
}

const { content } = Astro.props;
const { title, tags } = content.data;
const { collection, slug } = content;
---

<div class="relative card-sm flex-row">
    {
        collection === "tools" && (
            <div class="flex items-center justify-between w-full">
                <div class="flex items-center gap-4">
                    <h3 class="flex justify-left truncate w-fit">{title}</h3>
                    <small class="max-sm:hidden">{content.data.version}</small>
                    <span class="max-sm:hidden">
                        <Badge label={content.data.price} />
                    </span>
                </div>
                <strong class="max-sm:hidden">
                    <small class="flex gap-2">
						<strong>{content.data.size}</strong>
						&bullet;
						<strong>{formatDate(content.data.postDate, "short")}</strong>
					</small>
                </strong>
            </div>
        )
    }
    {
        collection === "posts" && (
            <div class="flex items-center justify-between w-full">
                <h3 class="flex justify-left truncate w-fit">{title}</h3>
                <strong class="max-sm:hidden">
                    <small class="flex gap-2">
						<strong>{calcReadTime(content.body)} min read</strong>
						&bullet;
						<strong>{formatDate(content.data.postDate, "short")}</strong>
					</small>
                </strong>
            </div>
        )
    }
	<div class="flex gap-2">
        {
            collection === "tools" && (
                <Button label="View details" href={`/${collection}/${slug}`} icon="arrow-right" responsive />
                <Button class="max-sm:hidden" href={content.data.href} icon="download" primary />
            )
        }
        {
            collection === "posts" && (
                <Button label="Read post" href={`/${collection}/${slug}`} icon="arrow-right" responsive />
            )
        }
        {
            content.collection === "posts" && content.data.embed && (
                <Button class="max-sm:hidden" href={`http://youtu.be/${content.data.embed}`} icon="youtube" primary />
            )
        }
	</div>
    {
        collection === "posts" && content.data.image && (
            <div class="absolute -top-2 -left-28 max-sm:hidden">
                <ImageWrapper
                    src={`${collection}/${content.slug}/header.png`}
                    alt={content.data.title}
                    size="sm"
                    aspect="1/1"
                    shape="round"
                />
            </div>
        )
    }
    {
        (collection === "tools" && content.data.icon) && (
            <div
                data-icon
                class="absolute -top-2 -left-28 flex justify-center items-center  border-lg shadow-lg w-24 rounded-full aspect-square bg-orange max-sm:hidden"
            >
                <Icon name={matchIconNameType(content.data.icon)} size="64" />
            </div>
        )
    }
    <div class="absolute -bottom-4">
        <TagList {tags} />
    </div>
</div>

<style>
    [data-icon] {
        &::after {
            position: absolute;

            width: 100%;
            height: 100%;

            border-radius: 999px;
            border: solid white 4px;
            content: "";
        }
    }
</style>