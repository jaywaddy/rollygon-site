{% from "./menu-link.njk" import menu_link %}
{% from "../icons/menu-icon.njk" import menu_icon %}

{% set external_links = [
    {title: "YouTube", url: "https://youtube.com/@rollygon/streams", altText: "/@Rollygon"},
    {title: "Sketchfab", url: "https://sketchfab.com/rollygon/models", altText: "/Rollygon"},
    {title: "Bluesky", url: "https://rollygon.bsky.social", altText: "Rollygon.bsky.social"},
    {title: "Gumroad", url: "https://rollygon.gumroad.com", altText: "Rollygon.gumroad.com"}
] %}

{% set nav_links = [
    {title: "/ home", url: "/"},
    {title: "/ builds", url: "/builds"},
    {title: "/ blog", url: "/blog"},
    {title: "/ about", url: "/about"}
] %}

<style>
	.menu__wrapper {
	row-gap: var(--gap-m);
	min-height: 100dvh;
	padding-block: var(--gap-m);

	flex-direction: column-reverse;
}

.menu {
	position: fixed;
	display: flex;

	overflow-x: visible;
	overflow-y: scroll;

	inset: 0;
	min-width: 100vw;
	height: 100%;

	background-color: var(--clr-menu-background);

	translate: 100%;
	transition: translate 0.5s ease-in-out;
}

.rollygon-text {
	display: flex;
	align-self: center;
}

.menu__nav {
	margin-top: auto;
}

.menu__links {
	display: flex;
	flex-direction: column;
	gap: var(--gap-s);

	list-style: none;
	padding: 0;
}

.menu__item {
	display: flex;
	color: var(--clr-text--faded);
}

.link {
	display: flex;
	flex-direction: row;

	margin-inline-end: 0.5em;
	font-weight: 900;
}

.link__arrow-icon {
	display: flex;
	align-self: center;
	margin-inline-start: auto;
}

.menu__button {
	position: fixed;
	display: flex;
	justify-content: center;
	align-items: center;

	border: 0;
	padding: 0;
	background: none;

	bottom: var(--gap-m);
	right: var(--gap-m);
	z-index: 999;
}

#menu__button__toggle {
	width: var(--gap-m);
	height: var(--gap-m);

	border-radius: 50px;

	background-color: var(--clr-primary);

	appearance: none;
	cursor: pointer;
}

.menu__button:has(#menu__button__toggle:checked) + .menu {
	translate: 0%;
}

.menu__button:has(#menu__button__toggle:checked) #menu-icon {
	rotate: -0.25turn;
}

/* .menu__button:has(#menu__button__toggle:checked) .menu-icon__path {
	animation-name: stroke-thickness-open;
	animation-duration: 1s;
} */

.menu__button:has(#menu__button__toggle:checked) #menu-icon__path-a {
	stroke-dashoffset: -203;
}

.menu__button:has(#menu__button__toggle:checked) #menu-icon__path-b {
	stroke-dashoffset: -254.5;
}

#menu-icon {
	position: absolute;

	rotate: 0turn;
	transition: 0.4s cubic-bezier(0.2,-0.8,0.6,1.9);
	pointer-events: none;
}

#menu-icon__path-a {
	transition-delay: 0.2s;
}

#menu-icon__path-b {
	transition-delay: 0.2s;
}

.menu-icon__path {
	/* animation-name: stroke-thickness-close;
	animation-duration: 1s; */

	transition: 0.6s cubic-bezier(.3,-0.4,.61,1.3);

	stroke-width: 4px;
	stroke-dasharray: 25 1000;
	stroke-dashoffset: -6.5;
}

@keyframes stroke-thickness-open {
	20% { stroke-width: 4px; }
	55% { stroke-width: 8px; }
	85% { stroke-width: 2px; }
	100% { stroke-width: 4px; }
}

@keyframes stroke-thickness-close {
	20% { stroke-width: 4px; }
	55% { stroke-width: 8px; }
	85% { stroke-width: 2px; }
	100% { stroke-width: 4px; }
}
</style>

{% macro menu(lastUpdate) %}
<button class="menu__button">
	<input id="menu__button__toggle" type="checkbox" />
	{{ menu_icon("var(--clr-neutral-50)") }}
</button>
<aside class="menu">
	<div class="content-wrapper menu__wrapper">
		<img
			class="rollygon-text"
			src="/assets/img/rollygon-text.svg"
			alt="Rollygon."
			width="256px"
		/>
		<ul class="menu__links">
		{%- for link in external_links -%}
            <li class="menu__item">{{ menu_link(link.title, link.url, link.altText) }}</li>
        {%- endfor -%}
		</ul>
		<nav class="menu__nav">
			<ul class="menu__links">
			{%- for link in nav_links -%}
				<li class="menu__item">{{ menu_link(link.title, link.url) }}</li>
			{%- endfor -%}
			</ul>
		</nav>
		<span>&copy; {% year %} Rollygon</span>
	</div>
</aside>
{% endmacro %}